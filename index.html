<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quiz Parser</title>
<style>
  body { font-family: Arial; padding:20px;}
  .block { background:#f7f7f7; padding:15px; margin-bottom:15px; border-radius:8px; }
  pre { white-space: pre-wrap; }
</style>
<script>
  const password = "itsnotme"; // change to your password

  const userInput = prompt("Enter password:");
  if (userInput !== password) {
    document.body.innerHTML = "Access denied.";
  }
</script>
</head>
<body>

<h2>Quiz Questions + Options + Correct Answer</h2>

<select id="xmlSelect">
  <option value="/med/medborgerskabsproeven-may-2025.xml">May 2025 Quiz</option>
   <option value="/med/1.xml">1</option>
    <option value="/med/2.xml">2</option>
</select>
<button onclick="loadQuiz()">Load</button>

<div id="results"></div>

<script>
async function loadQuiz() {
  const url = document.getElementById("xmlSelect").value;
  const results = document.getElementById("results");
  results.innerHTML = "Loading...";

  const res = await fetch(url);
  const xmlText = await res.text();

  parseQuiz(xmlText);
}

function parseQuiz(xmlString) {
  const xml = new DOMParser().parseFromString(xmlString, "text/xml");
  const results = document.getElementById("results");
  results.innerHTML = "";

  const questions = xml.querySelectorAll("question");

  questions.forEach((qNode, index) => {

    /* ────────────────────────────────
       1️⃣ Extract QUESTION TEXT
       ────────────────────────────────*/
    let questionText = "";
    const qTextNode = qNode.querySelector('text[id="question"]');

    if (qTextNode) {
      questionText = extractPlainText(qTextNode);
    }

    /* ────────────────────────────────
       2️⃣ Extract OPTIONS
       ────────────────────────────────*/
    let options = [];
    qNode.querySelectorAll("option text").forEach(optNode => {
      options.push(extractPlainText(optNode));
    });

    /* ────────────────────────────────
       3️⃣ Extract CORRECT ANSWER from <fb id="fail">
       ────────────────────────────────*/
    let correctAnswer = "";
    const failNode = qNode.querySelector('fb[id="fail"] text');

    if (failNode) {
      const html = extractPlainText(failNode);

      // The CDATA contains: "The correct answer is : Arbejdstid"
      const match = html.match(/The correct answer is\s*:\s*(.+)/i);
      if (match) correctAnswer = match[1].trim();
    }

    /* ────────────────────────────────
       RENDER BLOCK
       ────────────────────────────────*/
    const block = document.createElement("div");
    block.className = "block";

    block.innerHTML = `
      <pre>
<b>Q${index+1}:</b> ${questionText}

<b>Options:</b>
${options.map(o => "  - " + o).join("\n")}

<b>Answer:</b> ${correctAnswer}
      </pre>
    `;

    results.appendChild(block);
  });
}

/* Utility: extract plain text from CDATA containing HTML */
function extractPlainText(node) {
  let text = "";

  node.childNodes.forEach(n => {
    if (n.nodeType === Node.CDATA_SECTION_NODE) {
      const temp = document.createElement("div");
      temp.innerHTML = n.data;
      text += temp.textContent.trim();
    }
    if (n.nodeType === Node.TEXT_NODE) {
      text += n.textContent.trim();
    }
  });

  return text.trim();
}
</script>

</body>
</html>
